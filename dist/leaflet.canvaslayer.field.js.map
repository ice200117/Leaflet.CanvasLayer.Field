{"version":3,"sources":["webpack:///webpack/bootstrap 762ea87d738b191f2a1d","webpack:///./Cell.js","webpack:///./Field.js","webpack:///./ScalarField.js","webpack:///./Vector.js","webpack:///./VectorField.js","webpack:///./control/L.Control.ColorBar.js","webpack:///./layer/L.CanvasLayer.Field.js","webpack:///./layer/L.CanvasLayer.ScalarField.js","webpack:///./layer/L.CanvasLayer.SimpleLonLat.js","webpack:///./layer/L.CanvasLayer.VectorFieldAnim.js","webpack:///./layer/L.CanvasLayer.js","webpack:///../~/@turf/inside/index.js","webpack:///../~/@turf/invariant/index.js","webpack:///./_main.js"],"names":["Cell","center","value","xSize","ySize","anotherCell","equals","_equalValues","anotherValue","type","constructor","name","answerFor","Number","Vector","u","v","halfX","halfY","cLat","lat","cLng","lng","ul","L","latLng","lr","latLngBounds","Field","params","nCols","nRows","width","height","xllCorner","yllCorner","xurCorner","yurCorner","cellXSize","cellYSize","grid","isContinuous","longitudeNeedsToBeWrapped","_inFilter","_spatialMask","TypeError","range","_calculateRange","stride","cells","j","i","_lonLatAtIndexes","lon","_valueAtIndexes","c","push","f","_updateRange","m","_getWrappedLongitudes","xmin","xmax","_pointInMask","_pointInExtent","longitudeIn","latitudeIn","pt","geometry","coordinates","properties","poly","inside","contains","notContains","_getDecimalIndexes","interpolatedValueAtIndexes","indexes","_getFourSurroundingIndexes","fi","ci","fj","cj","values","_getFourSurroundingValues","g00","g10","g01","g11","_doInterpolation","Math","floor","_clampColumnIndex","_clampRowIndex","row","_isValid","ii","jj","valueAt","hasValue","included","hasValueAt","o","random","x","_longitudeAtX","y","_latitudeAtY","halfXPixel","halfYPixel","maxCol","maxRow","undefined","ScalarField","asc","scaleFactor","lines","split","header","_parseASCIIGridHeader","slice","zs","length","line","trim","items","forEach","floatItem","parseFloat","it","noDataValue","p","res","nx","ny","lo1","la2","dx","dy","data","headerLines","headerItems","map","filter","param","toUpperCase","usesCorner","cellSize","parseInt","err","Error","bandIndex","multipleFromGeoTIFF","bandIndexes","tiff","GeoTIFF","parse","image","getImage","rasters","readRasters","tiepoint","getTiePoints","fileDirectory","getFileDirectory","ModelPixelScale","xScale","yScale","Array","keys","scalarFields","GDAL_NODATA","noData","simpleZS","from","z","getWidth","getHeight","_buildGrid","_arrayTo2d","array","d3","min","max","rx","ry","sqrt","verticalAngle","atan2","inDegrees","PI","a","directionTo","opposite","VectorField","ascU","ascV","fromASCIIGrid","_paramsFromScalarFields","gtU","gtV","fromGeoTIFF","geotiffData","bandIndexesForUV","us","vs","_getFunctionFor","_applyOnField","uv","func","n","numCells","_arraysTo2d","valid","vectors","getCells","magnitudes","magnitude","b","d","Control","ColorBar","extend","options","position","margin","background","textColor","steps","decimals","units","title","labels","labelFontSize","cb","index","labelTextPosition","initialize","color","Util","setOptions","console","log","select","colorBar","attr","unit","_createUnitToggle","onAdd","_map","div","DomUtil","create","style","padding","DomEvent","addListener","stopPropagation","preventDefault","backgroundColor","cursor","innerHTML","palette","_nextUnit","document","createElement","lb","label","append","text","svg","_createSvgIn","_createUlIn","_appendColorBarTo","_appendLabelsTo","_appendPhoneColorBarTo","that","colorList","phoneColoe","key","currentText","conversion","precision","toFixed","insert","spaceForLabels","colorPerValue","_getColorPerValue","w","groupBars","buckets","selectAll","enter","hex","positionPerLabelValue","_getPositionPerLabelValue","groupLabels","delta","xPositionFor","scaleLinear","domain","positionPerLabel","id","size","next","show","control","CanvasLayer","mouseMoveCursor","noValue","opacity","onClick","onMouseMove","inFilter","field","_visible","setData","getEvents","events","prototype","call","zoomstart","_hideCanvas","bind","zoomend","_showCanvas","onLayerDidMount","_enableIdentify","_ensureCanvasAlignment","hide","_disableIdentify","isVisible","_canvas","visibility","on","_onClick","_onMouseMove","off","topLeft","containerPointToLayerPoint","setPosition","onLayerWillUnmount","needRedraw","_field","onDrawLayer","viewInfo","setFilter","fire","setOpacity","_updateOpacity","getBounds","bb","extent","southWest","northEast","bounds","e","_queryValue","_changeCursorOn","getContainer","latlng","result","_getDrawingContext","g","getContext","clearRect","interpolate","vectorSize","arrowDirection","scalarField","_defaultColorScale","chroma","scale","setColor","r","_getRendererMethod","_drawImage","_drawArrows","_ensureColor","ctx","img","createImageData","_prepareImageIn","putImageData","deg2rad","deg","rad2deg","ang","_invert","windy","mapLonDelta","east","west","worldMapRadius","mapOffsetY","sin","south","equatorY","atan","exp","pos","step","pointCoords","containerPointToLatLng","_getColorFor","rgba","R","G","B","A","_pixelBounds","pixelSize","strokeStyle","currentBounds","cell","_drawArrow","northWest","latLngToContainerPoint","getNorthWest","southEast","getSouthEast","pixelBounds","projected","save","translate","rotationRads","rotate","beginPath","moveTo","lineTo","stroke","restore","canvasLayer","SimpleLonLat","points","canvas","fillStyle","point","layer","fillRect","fill","closePath","xs","ys","ymin","ymax","simpleLonLat","lonslats","VectorFieldAnim","paths","fade","duration","maxAge","velocityScale","vectorField","timer","_stopAnimation","_prepareParticlePaths","_moveParticles","_drawParticles","self","par","age","randomPosition","vector","xt","yt","prev","globalCompositeOperation","lineWidth","_drawParticle","source","target","pA","pB","_randomAge","stop","vectorFieldAnim","Layer","_frame","_delegate","delegate","del","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","newSize","_onLayerDidMove","resize","moveend","zoomAnimation","Browser","any3d","zoomanim","_animateZoom","tiles","getSize","animated","addClass","_panes","overlayPane","appendChild","setTimeout","onRemove","getPanes","removeChild","addTo","addLayer","LatLonToMercator","latlon","tan","zoom","getZoom","getCenter","corner","_setTransform","el","offset","Point","TRANSFORM","ie3d","getZoomScale","_latLngToNewLayerPoint","setTransform","window","require"],"mappings":"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;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,+BAA+B;AAC1C,aAAa,cAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,KAAK;AACL;;AAEA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,WAAW;AACtB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wCAAwC,cAAc;AACtD,yBAAyB,kBAAkB;AAC3C;AACA;AACA,WAAW,QAAQ;AACnB,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wCAAwC,wBAAwB;AAChE,yBAAyB,kBAAkB;AAC3C;AACA;AACA,WAAW,kBAAkB;AAC7B,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,uCAAuC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,iBAAiB;AAC5B,aAAa,cAAc;AAC3B,YAAY,MAAM;AAClB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,iBAAiB;AAC5B,aAAa,OAAO;AACpB,YAAY,MAAM;AAClB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9MA;AAAA;AACA;AACA0N,OAAOrf,CAAP,CAASV,MAAT,GAAkB,2DAAlB;;AAEA;AACA+f,OAAOrf,CAAP,CAASxB,IAAT,GAAgB,yDAAhB;;AAEA;AACA6gB,OAAOrf,CAAP,CAASI,KAAT,GAAiB,0DAAjB;;AAEA;AACAif,OAAOrf,CAAP,CAASyF,WAAT,GAAuB,gEAAvB;;AAEA;AACA4Z,OAAOrf,CAAP,CAAS0K,WAAT,GAAuB,gEAAvB;;AAEA;AACA,mBAAA4U,CAAQ,EAAR;AACA,mBAAAA,CAAQ,CAAR;AACA,mBAAAA,CAAQ,CAAR;AACA,mBAAAA,CAAQ,CAAR;AACA,mBAAAA,CAAQ,CAAR;;AAEA;AACA,mBAAAA,CAAQ,CAAR;;AAEA;AACA7R,QAAQC,GAAR,CAAY,kCAAZ;AACA,8B","file":"leaflet.canvaslayer.field.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 762ea87d738b191f2a1d","/**\r\n *  Simple regular cell in a raster\r\n */\r\nexport default class Cell {\r\n    /**\r\n     * A simple cell with a numerical value\r\n     * @param {L.LatLng} center\r\n     * @param {Number|Vector} value\r\n     * @param {Number} xSize\r\n     * @param {Number} ySize\r\n     */\r\n    constructor(center, value, xSize, ySize = xSize) {\r\n        this.center = center;\r\n        this.value = value;\r\n        this.xSize = xSize;\r\n        this.ySize = ySize;\r\n    }\r\n\r\n    equals(anotherCell) {\r\n        return (\r\n            this.center.equals(anotherCell.center) &&\r\n            this._equalValues(this.value, anotherCell.value) &&\r\n            this.xSize === anotherCell.xSize &&\r\n            this.ySize === anotherCell.ySize\r\n        );\r\n    }\r\n\r\n    _equalValues(value, anotherValue) {\r\n        let type = value.constructor.name;\r\n        let answerFor = {\r\n            Number: value === anotherValue,\r\n            Vector: value.u === anotherValue.u && value.v === anotherValue.v\r\n        };\r\n        return answerFor[type];\r\n    }\r\n\r\n    /**\r\n     * Bounds for the cell\r\n     * @returns {LatLngBounds}\r\n     */\r\n    getBounds() {\r\n        let halfX = this.xSize / 2.0;\r\n        let halfY = this.ySize / 2.0;\r\n        let cLat = this.center.lat;\r\n        let cLng = this.center.lng;\r\n        let ul = L.latLng([cLat + halfY, cLng - halfX]);\r\n        let lr = L.latLng([cLat - halfY, cLng + halfX]);\r\n\r\n        return L.latLngBounds(\r\n            L.latLng(lr.lat, ul.lng),\r\n            L.latLng(ul.lat, lr.lng)\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./Cell.js","import Cell from './Cell';\r\nimport inside from '@turf/inside';\r\n\r\n/**\r\n *  Abstract class for a set of values (Vector | Scalar)\r\n *  assigned to a regular 2D-grid (lon-lat), aka 'a Raster source'\r\n */\r\nexport default class Field {\r\n    constructor(params) {\r\n        this.params = params;\r\n\r\n        this.nCols = params['nCols'];\r\n        this.nRows = params['nRows'];\r\n\r\n        // alias\r\n        this.width = params['nCols'];\r\n        this.height = params['nRows'];\r\n\r\n        // ll = lower-left\r\n        this.xllCorner = params['xllCorner'];\r\n        this.yllCorner = params['yllCorner'];\r\n\r\n        // ur = upper-right\r\n        this.xurCorner =\r\n            params['xllCorner'] + params['nCols'] * params['cellXSize'];\r\n        this.yurCorner =\r\n            params['yllCorner'] + params['nRows'] * params['cellYSize'];\r\n\r\n        this.cellXSize = params['cellXSize'];\r\n        this.cellYSize = params['cellYSize'];\r\n\r\n        this.grid = null; // to be defined by subclasses\r\n        this.isContinuous = this.xurCorner - this.xllCorner >= 360;\r\n        this.longitudeNeedsToBeWrapped = this.xurCorner > 180; // [0, 360] --> [-180, 180]\r\n\r\n        this._inFilter = null;\r\n        this._spatialMask = null;\r\n    }\r\n\r\n    /**\r\n     * Builds a grid with a value at each point (either Vector or Number)\r\n     * Original params must include the required input values, following\r\n     * x-ascending & y-descending order (same as in ASCIIGrid)\r\n     * @abstract\r\n     * @private\r\n     * @returns {Array.<Array.<Vector|Number>>} - grid[row][column]--> Vector|Number\r\n     */\r\n    _buildGrid() {\r\n        throw new TypeError('Must be overriden');\r\n    }\r\n\r\n    _updateRange() {\r\n        this.range = this._calculateRange();\r\n    }\r\n\r\n    /**\r\n     * Number of cells in the grid (rows * cols)\r\n     * @returns {Number}\r\n     */\r\n    numCells() {\r\n        return this.nRows * this.nCols;\r\n    }\r\n\r\n    /**\r\n     * A list with every cell\r\n     * @returns {Array<Cell>} - cells (x-ascending & y-descending order)\r\n     */\r\n    getCells(stride = 1) {\r\n        let cells = [];\r\n        for (let j = 0; j < this.nRows; j = j + stride) {\r\n            for (let i = 0; i < this.nCols; i = i + stride) {\r\n                let [lon, lat] = this._lonLatAtIndexes(i, j);\r\n                let center = L.latLng(lat, lon);\r\n                let value = this._valueAtIndexes(i, j);\r\n                let c = new Cell(center, value, this.cellXSize, this.cellYSize);\r\n                cells.push(c); // <<\r\n            }\r\n        }\r\n        return cells;\r\n    }\r\n\r\n    /**\r\n     * Apply a filter function to field values\r\n     * @param   {Function} f - boolean function\r\n     */\r\n    setFilter(f) {\r\n        this._inFilter = f;\r\n        this._updateRange();\r\n    }\r\n\r\n    /**\r\n     * Apply a spatial mask to field values\r\n     * @param {L.GeoJSON} m \r\n     */\r\n    setSpatialMask(m) {\r\n        this._spatialMask = m;\r\n    }\r\n\r\n    /**\r\n     * Grid extent\r\n     * @returns {Number[]} [xmin, ymin, xmax, ymax]\r\n     */\r\n    extent() {\r\n        let [xmin, xmax] = this._getWrappedLongitudes();\r\n        return [xmin, this.yllCorner, xmax, this.yurCorner];\r\n    }\r\n\r\n    /**\r\n     * [xmin, xmax] in [-180, 180] range\r\n     */\r\n    _getWrappedLongitudes() {\r\n        let xmin = this.xllCorner;\r\n        let xmax = this.xurCorner;\r\n\r\n        if (this.longitudeNeedsToBeWrapped) {\r\n            if (this.isContinuous) {\r\n                xmin = -180;\r\n                xmax = 180;\r\n            } else {\r\n                // not sure about this (just one particular case, but others...?)\r\n                xmax = this.xurCorner - 360;\r\n                xmin = this.xllCorner - 360;\r\n                /* eslint-disable no-console */\r\n                // console.warn(`are these xmin: ${xmin} & xmax: ${xmax} OK?`);\r\n                // TODO: Better throw an exception on no-controlled situations.\r\n                /* eslint-enable no-console */\r\n            }\r\n        }\r\n        return [xmin, xmax];\r\n    }\r\n\r\n    /**\r\n     * Returns whether or not the grid contains the point, considering\r\n     * the spatialMask if it has been previously set\r\n     * @param   {Number} lon - longitude\r\n     * @param   {Number} lat - latitude\r\n     * @returns {Boolean}\r\n     */\r\n    contains(lon, lat) {\r\n        if (this._spatialMask) {\r\n            return this._pointInMask(lon, lat);\r\n        }\r\n        return this._pointInExtent(lon, lat);\r\n    }\r\n\r\n    /**\r\n     * Checks if coordinates are inside the Extent (considering wrapped longitudes if needed)\r\n     * @param {Number} lon \r\n     * @param {Number} lat \r\n     */\r\n    _pointInExtent(lon, lat) {\r\n        let [xmin, xmax] = this._getWrappedLongitudes();\r\n        let longitudeIn = lon >= xmin && lon <= xmax;\r\n        let latitudeIn = lat >= this.yllCorner && lat <= this.yurCorner;\r\n        return longitudeIn && latitudeIn;\r\n    }\r\n\r\n    /**\r\n     * Check if coordinates are inside the spatialMask (Point in Polygon analysis)\r\n     * @param {Number} lon \r\n     * @param {Number} lat \r\n     */\r\n    _pointInMask(lon, lat) {\r\n        const pt = {\r\n            type: 'Feature',\r\n            geometry: {\r\n                type: 'Point',\r\n                coordinates: [lon, lat] // geojson, lon-lat order !\r\n            },\r\n            properties: {}\r\n        };\r\n        const poly = this._spatialMask;\r\n        return inside(pt, poly);\r\n    }\r\n\r\n    /**\r\n     * Returns if the grid doesn't contain the point\r\n     * @param   {Number} lon - longitude\r\n     * @param   {Number} lat - latitude\r\n     * @returns {Boolean}\r\n     */\r\n    notContains(lon, lat) {\r\n        return !this.contains(lon, lat);\r\n    }\r\n\r\n    /**\r\n     * Interpolated value at lon-lat coordinates (bilinear method)\r\n     * @param   {Number} longitude\r\n     * @param   {Number} latitude\r\n     * @returns {Vector|Number} [u, v, magnitude]\r\n     *                          \r\n     * Source: https://github.com/cambecc/earth > product.js\r\n     */\r\n    interpolatedValueAt(lon, lat) {\r\n        if (this.notContains(lon, lat)) return null;\r\n\r\n        let [i, j] = this._getDecimalIndexes(lon, lat);\r\n        return this.interpolatedValueAtIndexes(i, j);\r\n    }\r\n\r\n    /**\r\n     * Interpolated value at i-j indexes (bilinear method)\r\n     * @param   {Number} i\r\n     * @param   {Number} j\r\n     * @returns {Vector|Number} [u, v, magnitude]\r\n     *\r\n     * Source: https://github.com/cambecc/earth > product.js\r\n     */\r\n    interpolatedValueAtIndexes(i, j) {\r\n        //         1      2           After converting  and  to fractional grid indexes i and j, we find the\r\n        //        fi  i   ci          four points 'G' that enclose point (i, j). These points are at the four\r\n        //         | =1.4 |           corners specified by the floor and ceiling of i and j. For example, given\r\n        //      ---G--|---G--- fj 8   i = 1.4 and j = 8.3, the four surrounding grid points are (1, 8), (2, 8),\r\n        //    j ___|_ .   |           (1, 9) and (2, 9).\r\n        //  =8.3   |      |\r\n        //      ---G------G--- cj 9   Note that for wrapped grids, the first column is duplicated as the last\r\n        //         |      |           column, so the index ci can be used without taking a modulo.\r\n\r\n        let indexes = this._getFourSurroundingIndexes(i, j);\r\n        let [fi, ci, fj, cj] = indexes;\r\n        let values = this._getFourSurroundingValues(fi, ci, fj, cj);\r\n        if (values) {\r\n            let [g00, g10, g01, g11] = values;\r\n            return this._doInterpolation(i - fi, j - fj, g00, g10, g01, g11);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Get decimal indexes\r\n     * @private\r\n     * @param {Number} lon\r\n     * @param {Number} lat\r\n     * @returns {Array}    [[Description]]\r\n     */\r\n    _getDecimalIndexes(lon, lat) {\r\n        if (this.longitudeNeedsToBeWrapped && lon < this.xllCorner) {\r\n            lon = lon + 360;\r\n        }\r\n        let i = (lon - this.xllCorner) / this.cellXSize;\r\n        let j = (this.yurCorner - lat) / this.cellYSize;\r\n        return [i, j];\r\n    }\r\n\r\n    /**\r\n     * Get surrounding indexes (integer), clampling on borders\r\n     * @private\r\n     * @param   {Number} i - decimal index\r\n     * @param   {Number} j - decimal index\r\n     * @returns {Array} [fi, ci, fj, cj]\r\n     */\r\n    _getFourSurroundingIndexes(i, j) {\r\n        let fi = Math.floor(i);\r\n        let ci = fi + 1;\r\n        // duplicate colum to simplify interpolation logic (wrapped value)\r\n        if (this.isContinuous && ci >= this.nCols) {\r\n            ci = 0;\r\n        }\r\n        ci = this._clampColumnIndex(ci);\r\n\r\n        let fj = this._clampRowIndex(Math.floor(j));\r\n        let cj = this._clampRowIndex(fj + 1);\r\n\r\n        return [fi, ci, fj, cj];\r\n    }\r\n\r\n    /**\r\n     * Get four surrounding values or null if not available,\r\n     * from 4 integer indexes\r\n     * @private\r\n     * @param   {Number} fi\r\n     * @param   {Number} ci\r\n     * @param   {Number} fj\r\n     * @param   {Number} cj\r\n     * @returns {Array} \r\n     */\r\n    _getFourSurroundingValues(fi, ci, fj, cj) {\r\n        var row;\r\n        if ((row = this.grid[fj])) {\r\n            // upper row ^^\r\n            var g00 = row[fi]; // << left\r\n            var g10 = row[ci]; // right >>\r\n            if (\r\n                this._isValid(g00) &&\r\n                this._isValid(g10) &&\r\n                (row = this.grid[cj])\r\n            ) {\r\n                // lower row vv\r\n                var g01 = row[fi]; // << left\r\n                var g11 = row[ci]; // right >>\r\n                if (this._isValid(g01) && this._isValid(g11)) {\r\n                    return [g00, g10, g01, g11]; // 4 values found!\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Nearest value at lon-lat coordinates\r\n     * @param   {Number} longitude\r\n     * @param   {Number} latitude\r\n     * @returns {Vector|Number}\r\n     */\r\n    valueAt(lon, lat) {\r\n        if (this.notContains(lon, lat)) return null;\r\n\r\n        let [i, j] = this._getDecimalIndexes(lon, lat);\r\n        let ii = Math.floor(i);\r\n        let jj = Math.floor(j);\r\n\r\n        const ci = this._clampColumnIndex(ii);\r\n        const cj = this._clampRowIndex(jj);\r\n\r\n        let value = this._valueAtIndexes(ci, cj);\r\n        if (this._inFilter) {\r\n            if (!this._inFilter(value)) return null;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Returns whether or not the field has a value at the point\r\n     * @param   {Number} lon - longitude\r\n     * @param   {Number} lat - latitude\r\n     * @returns {Boolean}\r\n     */\r\n    hasValueAt(lon, lat) {\r\n        let value = this.valueAt(lon, lat);\r\n        let hasValue = value !== null;\r\n\r\n        let included = true;\r\n        if (this._inFilter) {\r\n            included = this._inFilter(value);\r\n        }\r\n        return hasValue && included;\r\n    }\r\n\r\n    /**\r\n     * Returns if the grid has no value at the point\r\n     * @param   {Number} lon - longitude\r\n     * @param   {Number} lat - latitude\r\n     * @returns {Boolean}\r\n     */\r\n    notHasValueAt(lon, lat) {\r\n        return !this.hasValueAt(lon, lat);\r\n    }\r\n\r\n    /**\r\n     * Gives a random position to 'o' inside the grid\r\n     * @param {Object} [o] - an object (eg. a particle)\r\n     * @returns {{x: Number, y: Number}} - object with x, y (lon, lat)\r\n     */\r\n    randomPosition(o = {}) {\r\n        let i = (Math.random() * this.nCols) | 0;\r\n        let j = (Math.random() * this.nRows) | 0;\r\n\r\n        o.x = this._longitudeAtX(i);\r\n        o.y = this._latitudeAtY(j);\r\n\r\n        return o;\r\n    }\r\n\r\n    /**\r\n     * Value for grid indexes\r\n     * @param   {Number} i - column index (integer)\r\n     * @param   {Number} j - row index (integer)\r\n     * @returns {Vector|Number}\r\n     */\r\n    _valueAtIndexes(i, j) {\r\n        return this.grid[j][i]; // <-- j,i !!\r\n    }\r\n\r\n    /**\r\n     * Lon-Lat for grid indexes\r\n     * @param   {Number} i - column index (integer)\r\n     * @param   {Number} j - row index (integer)\r\n     * @returns {Number[]} [lon, lat]\r\n     */\r\n    _lonLatAtIndexes(i, j) {\r\n        let lon = this._longitudeAtX(i);\r\n        let lat = this._latitudeAtY(j);\r\n\r\n        return [lon, lat];\r\n    }\r\n\r\n    /**\r\n     * Longitude for grid-index\r\n     * @param   {Number} i - column index (integer)\r\n     * @returns {Number} longitude at the center of the cell\r\n     */\r\n    _longitudeAtX(i) {\r\n        let halfXPixel = this.cellXSize / 2.0;\r\n        let lon = this.xllCorner + halfXPixel + i * this.cellXSize;\r\n        if (this.longitudeNeedsToBeWrapped) {\r\n            lon = lon > 180 ? lon - 360 : lon;\r\n        }\r\n        return lon;\r\n    }\r\n\r\n    /**\r\n     * Latitude for grid-index\r\n     * @param   {Number} j - row index (integer)\r\n     * @returns {Number} latitude at the center of the cell\r\n     */\r\n    _latitudeAtY(j) {\r\n        let halfYPixel = this.cellYSize / 2.0;\r\n        return this.yurCorner - halfYPixel - j * this.cellYSize;\r\n    }\r\n\r\n    /**\r\n     * Apply the interpolation\r\n     * @abstract\r\n     * @private\r\n     */\r\n    /* eslint-disable no-unused-vars */\r\n    _doInterpolation(x, y, g00, g10, g01, g11) {\r\n        throw new TypeError('Must be overriden');\r\n    }\r\n    /* eslint-disable no-unused-vars */\r\n\r\n    /**\r\n     * Check the column index is inside the field,\r\n     * adjusting to min or max when needed\r\n     * @private\r\n     * @param   {Number} ii - index\r\n     * @returns {Number} i - inside the allowed indexes\r\n     */\r\n    _clampColumnIndex(ii) {\r\n        let i = ii;\r\n        if (ii < 0) {\r\n            i = 0;\r\n        }\r\n        let maxCol = this.nCols - 1;\r\n        if (ii > maxCol) {\r\n            i = maxCol;\r\n        }\r\n        return i;\r\n    }\r\n\r\n    /**\r\n     * Check the row index is inside the field,\r\n     * adjusting to min or max when needed\r\n     * @private\r\n     * @param   {Number} jj index\r\n     * @returns {Number} j - inside the allowed indexes\r\n     */\r\n    _clampRowIndex(jj) {\r\n        let j = jj;\r\n        if (jj < 0) {\r\n            j = 0;\r\n        }\r\n        let maxRow = this.nRows - 1;\r\n        if (jj > maxRow) {\r\n            j = maxRow;\r\n        }\r\n        return j;\r\n    }\r\n\r\n    /**\r\n     * Is valid (not 'null' nor 'undefined')\r\n     * @private\r\n     * @param   {Object} x object\r\n     * @returns {Boolean}\r\n     */\r\n    _isValid(x) {\r\n        return x !== null && x !== undefined;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./Field.js","import Field from './Field';\r\n\r\n/**\r\n * Scalar Field\r\n */\r\nexport default class ScalarField extends Field {\r\n    /**\r\n     * Creates a ScalarField from the content of an ASCIIGrid file\r\n     * @param   {String}   asc\r\n     * @returns {ScalarField}\r\n     */\r\n    static fromASCIIGrid(asc, scaleFactor = 1) {\r\n        //console.time('ScalarField from ASC');\r\n\r\n        let lines = asc.split('\\n');\r\n\r\n        // Header\r\n        var header = ScalarField._parseASCIIGridHeader(lines.slice(0, 6));\r\n\r\n        // Data (left-right and top-down)\r\n        let zs = [];\r\n        for (let i = 6; i < lines.length; i++) {\r\n            let line = lines[i].trim();\r\n            if (line === '') break;\r\n\r\n            let items = line.split(' ');\r\n            items.forEach(it => {\r\n                let floatItem = parseFloat(it);\r\n                let v =\r\n                    floatItem !== header.noDataValue\r\n                        ? floatItem * scaleFactor\r\n                        : null;\r\n                zs.push(v);\r\n            });\r\n        }\r\n        let p = header;\r\n        p.zs = zs;\r\n\r\n        //console.timeEnd('ScalarField from ASC');\r\n        return new ScalarField(p);\r\n    }\r\n\r\n    /**\r\n     * Creates a ScalarField from the content of an PNG file\r\n     * @param   {String}   res\r\n     * @returns {ScalarField}\r\n     */\r\n    static fromPNGGrid(res) {\r\n        // Header\r\n        var header = {\r\n            nCols: res.header.nx,\r\n            nRows: res.header.ny,\r\n            xllCorner: res.header.lo1,\r\n            yllCorner: res.header.la2,\r\n            cellXSize: res.header.dx,\r\n            cellYSize: res.header.dy,\r\n            noDataValue: 7e+37\r\n        };\r\n\r\n        // Data (left-right and top-down)\r\n        // let zs = res.data;\r\n        // for (let i = 0; i < zs.length; i++) {\r\n        //     if(zs[i] == header.noDataValue) zs[i] = null;\r\n        // }\r\n        let p = header;\r\n        p.zs = res.data;\r\n        return new ScalarField(p);\r\n    }\r\n\r\n    /**\r\n     * Parse an ASCII Grid header, made with 6 lines\r\n     * It allows the use of XLLCORNER/YLLCORNER or XLLCENTER/YLLCENTER conventions\r\n     * @param {Array.String} headerLines\r\n     */\r\n    static _parseASCIIGridHeader(headerLines) {\r\n        try {\r\n            const headerItems = headerLines.map(line => {\r\n                var items = line.split(' ').filter(i => i != '');\r\n                var param = items[0].trim().toUpperCase();\r\n                var value = parseFloat(items[1].trim());\r\n                return { [param]: value };\r\n            });\r\n\r\n            const usesCorner = 'XLLCORNER' in headerItems[2];\r\n            const cellSize = headerItems[4]['CELLSIZE'];\r\n\r\n            const header = {\r\n                nCols: parseInt(headerItems[0]['NCOLS']),\r\n                nRows: parseInt(headerItems[1]['NROWS']),\r\n                xllCorner: usesCorner\r\n                    ? headerItems[2]['XLLCORNER']\r\n                    : headerItems[2]['XLLCENTER'] - cellSize,\r\n                yllCorner: usesCorner\r\n                    ? headerItems[3]['YLLCORNER']\r\n                    : headerItems[3]['YLLCENTER'] - cellSize,\r\n                cellXSize: cellSize,\r\n                cellYSize: cellSize,\r\n                noDataValue: headerItems[5]['NODATA_VALUE']\r\n            };\r\n            return header;\r\n        } catch (err) {\r\n            throw new Error(`Not a valid ASCIIGrid Header: ${err}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a ScalarField from the content of a GeoTIFF file\r\n     * @param   {ArrayBuffer}   data\r\n     * @param   {Number}   bandIndex\r\n     * @returns {ScalarField}\r\n     */\r\n    static fromGeoTIFF(data, bandIndex = 0) {\r\n        return ScalarField.multipleFromGeoTIFF(data, [bandIndex])[0];\r\n    }\r\n\r\n    /**\r\n     * Creates a ScalarField array (one per band) from the content of a GeoTIFF file\r\n     * @param   {ArrayBuffer}   data\r\n     * @param   {Array}   bandIndexes - if not provided all bands are returned\r\n     * @returns {Array.<ScalarField>}\r\n     */\r\n    static multipleFromGeoTIFF(data, bandIndexes) {\r\n        //console.time('ScalarField from GeoTIFF');\r\n\r\n        let tiff = GeoTIFF.parse(data); // geotiff.js\r\n        let image = tiff.getImage();\r\n        let rasters = image.readRasters();\r\n        let tiepoint = image.getTiePoints()[0];\r\n        let fileDirectory = image.getFileDirectory();\r\n        let [xScale, yScale] = fileDirectory.ModelPixelScale;\r\n\r\n        if (typeof bandIndexes === 'undefined' || bandIndexes.length === 0) {\r\n            bandIndexes = [...Array(rasters.length).keys()];\r\n        }\r\n\r\n        let scalarFields = [];\r\n        scalarFields = bandIndexes.map(function(bandIndex) {\r\n            let zs = rasters[bandIndex]; // left-right and top-down order\r\n\r\n            if (fileDirectory.GDAL_NODATA) {\r\n                let noData = parseFloat(fileDirectory.GDAL_NODATA);\r\n                // console.log(noData);\r\n                let simpleZS = Array.from(zs); // to simple array, so null is allowed | TODO efficiency??\r\n                zs = simpleZS.map(function(z) {\r\n                    return z === noData ? null : z;\r\n                });\r\n            }\r\n\r\n            let p = {\r\n                nCols: image.getWidth(),\r\n                nRows: image.getHeight(),\r\n                xllCorner: tiepoint.x,\r\n                yllCorner: tiepoint.y - image.getHeight() * yScale,\r\n                cellXSize: xScale,\r\n                cellYSize: yScale,\r\n                zs: zs\r\n            };\r\n            return new ScalarField(p);\r\n        });\r\n\r\n        //console.timeEnd('ScalarField from GeoTIFF');\r\n        return scalarFields;\r\n    }\r\n\r\n    constructor(params) {\r\n        super(params);\r\n        this.zs = params['zs'];\r\n\r\n        this.grid = this._buildGrid();\r\n        this._updateRange();\r\n        //console.log(`ScalarField created (${this.nCols} x ${this.nRows})`);\r\n    }\r\n\r\n    /**\r\n     * Builds a grid with a Number at each point, from an array\r\n     * 'zs' following x-ascending & y-descending order\r\n     * (same as in ASCIIGrid)\r\n     * @private\r\n     * @returns {Array.<Array.<Number>>} - grid[row][column]--> Number\r\n     */\r\n    _buildGrid() {\r\n        let grid = this._arrayTo2d(this.zs, this.nRows, this.nCols);\r\n        return grid;\r\n    }\r\n\r\n    _arrayTo2d(array, nRows, nCols) {\r\n        let grid = [];\r\n        let p = 0;\r\n        for (var j = 0; j < nRows; j++) {\r\n            var row = [];\r\n            for (var i = 0; i < nCols; i++, p++) {\r\n                let z = array[p];\r\n                row[i] = this._isValid(z) ? z : null; // <<<\r\n            }\r\n            grid[j] = row;\r\n        }\r\n        return grid;\r\n    }\r\n\r\n    _newDataArrays(params) {\r\n        params['zs'] = [];\r\n    }\r\n\r\n    _pushValueToArrays(params, value) {\r\n        params['zs'].push(value);\r\n    }\r\n\r\n    _makeNewFrom(params) {\r\n        return new ScalarField(params);\r\n    }\r\n\r\n    /**\r\n     * Calculate min & max values\r\n     * @private\r\n     * @returns {Array} - [min, max]\r\n     */\r\n    _calculateRange() {\r\n        var data = this.zs;\r\n        if (this._inFilter) {\r\n            data = data.filter(this._inFilter);\r\n        }\r\n        return [d3.min(data), d3.max(data)];\r\n    }\r\n\r\n    /**\r\n     * Bilinear interpolation for Number\r\n     * https://en.wikipedia.org/wiki/Bilinear_interpolation\r\n     * @param   {Number} x\r\n     * @param   {Number} y\r\n     * @param   {Number} g00\r\n     * @param   {Number} g10\r\n     * @param   {Number} g01\r\n     * @param   {Number} g11\r\n     * @returns {Number}\r\n     */\r\n    _doInterpolation(x, y, g00, g10, g01, g11) {\r\n        var rx = 1 - x;\r\n        var ry = 1 - y;\r\n        return g00 * rx * ry + g10 * x * ry + g01 * rx * y + g11 * x * y;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./ScalarField.js","/**\r\n *  2D Vector\r\n */\r\nexport default class Vector {\r\n\r\n    constructor(u, v) {\r\n        this.u = u;\r\n        this.v = v;\r\n    }\r\n\r\n    /**\r\n     * Magnitude\r\n     * @returns {Number}\r\n     */\r\n    magnitude() {\r\n        return Math.sqrt(this.u * this.u + this.v * this.v);\r\n    }\r\n\r\n    /**\r\n     * Angle in degrees (0 to 360) --> Towards\r\n     * N is 0 and E is 90\r\n     * @returns {Number}\r\n     */\r\n    directionTo() {\r\n        let verticalAngle = Math.atan2(this.u, this.v);\r\n        let inDegrees = verticalAngle * (180.0 / Math.PI);\r\n        if (inDegrees < 0) {\r\n            inDegrees = inDegrees + 360.0;\r\n        }\r\n        return inDegrees;\r\n    }\r\n\r\n    /**\r\n     * Angle in degrees (0 to 360) From x-->\r\n     * N is 0 and E is 90\r\n     * @returns {Number}\r\n     */\r\n    directionFrom() {\r\n        let a = this.directionTo();\r\n        let opposite = (a + 180.0) % 360.0;\r\n        return opposite;\r\n    }\r\n\r\n    /*\r\n        Degrees --> text\r\n        new Dictionary<int, string>\r\n        {\r\n            //{0, 23, 45, 68, 90, 113, 135, 158, 180, 203, 225, 248, 270, 293, 315, 338, 360};\r\n            {0, 'N'},\r\n            {23, 'NNE'},\r\n            {45, 'NE'},\r\n            {68, 'ENE'},\r\n            {90, 'E'},\r\n            {113, 'ESE'},\r\n            {135, 'SE'},\r\n            {158, 'SSE'},\r\n            {180, 'S'},\r\n            {203, 'SSW'},\r\n            {225, 'SW'},\r\n            {248, 'WSW'},\r\n            {270, 'W'},\r\n            {293, 'WNW'},\r\n            {315, 'NW'},\r\n            {338, 'NNW'},\r\n            {360, 'N'}\r\n        };\r\n    */\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./Vector.js","import Vector from './Vector';\r\nimport Field from './Field';\r\nimport ScalarField from './ScalarField';\r\n\r\n/**\r\n *  A set of vectors assigned to a regular 2D-grid (lon-lat)\r\n *  (e.g. a raster representing winds for a region)\r\n */\r\nexport default class VectorField extends Field {\r\n    /**\r\n     * Creates a VectorField from the content of two ASCIIGrid files\r\n     * @param   {String} ascU - with u-component\r\n     * @param   {String} ascV - with v-component\r\n     * @returns {VectorField}\r\n     */\r\n    static fromASCIIGrids(ascU, ascV, scaleFactor = 1) {\r\n        let u = ScalarField.fromASCIIGrid(ascU, scaleFactor);\r\n        let v = ScalarField.fromASCIIGrid(ascV, scaleFactor);\r\n        let p = VectorField._paramsFromScalarFields(u, v);\r\n\r\n        return new VectorField(p);\r\n    }\r\n\r\n    /**\r\n     * Creates a VectorField from the content of two different Geotiff files\r\n     * @param   {ArrayBuffer} gtU - geotiff data with u-component (band 0)\r\n     * @param   {ArrayBuffer} gtV - geotiff data with v-component (band 0)\r\n     * @returns {VectorField}\r\n     */\r\n    static fromGeoTIFFs(gtU, gtV) {\r\n        let u = ScalarField.fromGeoTIFF(gtU);\r\n        let v = ScalarField.fromGeoTIFF(gtV);\r\n        let p = VectorField._paramsFromScalarFields(u, v);\r\n\r\n        return new VectorField(p);\r\n    }\r\n\r\n    /**\r\n     * Creates a VectorField from the content of Multiband Geotiff\r\n     * @param   {ArrayBuffer} geotiffData - multiband\r\n     * @param   {Array} bandIndexesForUV\r\n     * @returns {VectorField}\r\n     */\r\n    static fromMultibandGeoTIFF(geotiffData, bandIndexesForUV = [0, 1]) {\r\n        let [u, v] = ScalarField.multipleFromGeoTIFF(\r\n            geotiffData,\r\n            bandIndexesForUV\r\n        );\r\n        let p = VectorField._paramsFromScalarFields(u, v);\r\n\r\n        return new VectorField(p);\r\n    }\r\n\r\n    /**\r\n     * Build parameters for VectorField, from 2 ScalarFields.\r\n     * No validation at all (nor interpolation) is applied, so u and v\r\n     * must be 'compatible' from the source\r\n     * @param   {ScalarField} u\r\n     * @param   {ScalarField} v\r\n     * @returns {Object} - parameters to build VectorField\r\n     */\r\n    static _paramsFromScalarFields(u, v) {\r\n        // TODO check u & v compatibility (cellSize...)\r\n        let p = {\r\n            nCols: u.nCols,\r\n            nRows: u.nRows,\r\n            xllCorner: u.xllCorner,\r\n            yllCorner: u.yllCorner,\r\n            cellXSize: u.cellXSize,\r\n            cellYSize: u.cellYSize,\r\n            us: u.zs,\r\n            vs: v.zs\r\n        };\r\n        return p;\r\n    }\r\n\r\n    constructor(params) {\r\n        super(params);\r\n\r\n        this.us = params['us'];\r\n        this.vs = params['vs'];\r\n        this.grid = this._buildGrid();\r\n        this.range = this._calculateRange();\r\n    }\r\n\r\n    /**\r\n     * Get a derived field, from a computation on\r\n     * the VectorField\r\n     * @param   {String} type ['magnitude' | 'directionTo' | 'directionFrom']\r\n     * @returns {ScalarField}\r\n     */\r\n    getScalarField(type) {\r\n        let f = this._getFunctionFor(type);\r\n        let p = {\r\n            nCols: this.params.nCols,\r\n            nRows: this.params.nRows,\r\n            xllCorner: this.params.xllCorner,\r\n            yllCorner: this.params.yllCorner,\r\n            cellXSize: this.params.cellXSize,\r\n            cellYSize: this.params.cellYSize,\r\n            zs: this._applyOnField(f)\r\n        };\r\n        return new ScalarField(p);\r\n    }\r\n\r\n    _getFunctionFor(type) {\r\n        return function(u, v) {\r\n            let uv = new Vector(u, v);\r\n            return uv[type](); // magnitude, directionTo, directionFrom\r\n        };\r\n    }\r\n\r\n    _applyOnField(func) {\r\n        let zs = [];\r\n        let n = this.numCells();\r\n        for (var i = 0; i < n; i++) {\r\n            let u = this.us[i];\r\n            let v = this.vs[i];\r\n            if (this._isValid(u) && this._isValid(v)) {\r\n                zs.push(func(u, v));\r\n            } else {\r\n                zs.push(null);\r\n            }\r\n        }\r\n        return zs;\r\n    }\r\n\r\n    /**\r\n     * Builds a grid with a Vector at each point, from two arrays\r\n     * 'us' and 'vs' following x-ascending & y-descending order\r\n     * (same as in ASCIIGrid)\r\n     * @returns {Array.<Array.<Vector>>} - grid[row][column]--> Vector\r\n     */\r\n    _buildGrid() {\r\n        let grid = this._arraysTo2d(this.us, this.vs, this.nRows, this.nCols);\r\n        return grid;\r\n    }\r\n\r\n    _arraysTo2d(us, vs, nRows, nCols) {\r\n        let grid = [];\r\n        let p = 0;\r\n\r\n        for (var j = 0; j < nRows; j++) {\r\n            var row = [];\r\n            for (var i = 0; i < nCols; i++, p++) {\r\n                let u = us[p],\r\n                    v = vs[p];\r\n                let valid = this._isValid(u) && this._isValid(v);\r\n                row[i] = valid ? new Vector(u, v) : null; // <<<\r\n            }\r\n            grid[j] = row;\r\n        }\r\n        return grid;\r\n    }\r\n\r\n    _newDataArrays(params) {\r\n        params['us'] = [];\r\n        params['vs'] = [];\r\n    }\r\n    _pushValueToArrays(params, value) {\r\n        //console.log(value);\r\n        params['us'].push(value.u);\r\n        params['vs'].push(value.v);\r\n    }\r\n    _makeNewFrom(params) {\r\n        return new VectorField(params);\r\n    }\r\n\r\n    /**\r\n     * Calculate min & max values (magnitude)\r\n     * @private\r\n     * @returns {Array}\r\n     */\r\n    _calculateRange() {\r\n        // TODO make a clearer method for getting these vectors...\r\n        let vectors = this.getCells()\r\n            .map(pt => pt.value)\r\n            .filter(function(v) {\r\n                return v !== null;\r\n            });\r\n\r\n        if (this._inFilter) {\r\n            vectors = vectors.filter(this._inFilter);\r\n        }\r\n\r\n        // TODO check memory crash with high num of vectors!\r\n        let magnitudes = vectors.map(v => v.magnitude());\r\n        let min = d3.min(magnitudes);\r\n        let max = d3.max(magnitudes);\r\n\r\n        return [min, max];\r\n    }\r\n\r\n    /**\r\n     * Bilinear interpolation for Vector\r\n     * https://en.wikipedia.org/wiki/Bilinear_interpolation\r\n     * @param   {Number} x\r\n     * @param   {Number} y\r\n     * @param   {Number[]} g00\r\n     * @param   {Number[]} g10\r\n     * @param   {Number[]} g01\r\n     * @param   {Number[]} g11\r\n     * @returns {Vector}\r\n     */\r\n    _doInterpolation(x, y, g00, g10, g01, g11) {\r\n        var rx = 1 - x;\r\n        var ry = 1 - y;\r\n        var a = rx * ry,\r\n            b = x * ry,\r\n            c = rx * y,\r\n            d = x * y;\r\n        var u = g00.u * a + g10.u * b + g01.u * c + g11.u * d;\r\n        var v = g00.v * a + g10.v * b + g01.v * c + g11.v * d;\r\n        return new Vector(u, v);\r\n    }\r\n\r\n    /**\r\n     * Is valid (not 'null' nor 'undefined')\r\n     * @private\r\n     * @param   {Object} x object\r\n     * @returns {Boolean}\r\n     */\r\n    _isValid(x) {\r\n        return x !== null && x !== undefined;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./VectorField.js","/**\r\n *   Control for a simple legend with a colorbar\r\n *   References:\r\n *      - http://jsfiddle.net/ramnathv/g8stqcf6/\r\n *      - http://jsfiddle.net/vis4/cYLZH/\r\n */\r\nL.Control.ColorBar = L.Control.extend({\r\n    options: {\r\n        position: 'bottomleft',\r\n        width: 300, // for colorbar itself (control is wider)\r\n        height: 15,\r\n        margin: 15,\r\n        background: '#fff',\r\n        textColor: 'black',\r\n        steps: 100,\r\n        decimals: 2,\r\n        units: 'uds', // ej: m/s\r\n        title: 'Legend', // ej: Ocean Currents\r\n        labels: [], // empty for no labels\r\n        labelFontSize: 10,\r\n        cb: null,\r\n        index: 0,\r\n        labelTextPosition: 'middle' // start | middle | end\r\n    },\r\n\r\n    initialize: function (color, range, options) {\r\n        this.color = color; // 'chromajs' scale function\r\n        this.range = range; // [min, max]\r\n        L.Util.setOptions(this, options);\r\n        console.log(this.options.index);\r\n        d3.select(this.colorBar).attr('data-index', this.options.index);\r\n        if (this.colorBar) this.unit = this._createUnitToggle(this.colorBar);\r\n    },\r\n\r\n\r\n    onAdd: function (map) {\r\n        this._map = map;\r\n        let div = L.DomUtil.create(\r\n            'div',\r\n            'leaflet-control-colorBar leaflet-bar leaflet-control'\r\n        );\r\n        this.colorBar = div;\r\n        div.style.padding = '10px';\r\n        L.DomEvent\r\n            .addListener(div, 'click', L.DomEvent.stopPropagation)\r\n            .addListener(div, 'click', L.DomEvent.preventDefault);\r\n        div.style.backgroundColor = this.options.background;\r\n        div.style.cursor = 'text';\r\n        this.unit = this._createUnitToggle(div);\r\n        div.innerHTML = this.title() + this.palette();\r\n        L.DomEvent\r\n            .addListener(div, 'click', this._nextUnit, this);\r\n        return div;\r\n    },\r\n\r\n\r\n    title: function () {\r\n        let d = document.createElement('div');\r\n        let lb = '';\r\n        if (this.unit.value().label !== '') {\r\n            lb = '(' + this.unit.value().label + ')';\r\n        }\r\n        d3\r\n            .select(d)\r\n            .append('span')\r\n            .style('color', this.options.textColor)\r\n            .style('display', 'block')\r\n            .style('margin-bottom', '5px')\r\n            .attr('class', 'leaflet-control-colorBar-title')\r\n            .text(this.options.title + lb);\r\n        return d.innerHTML;\r\n    },\r\n\r\n    palette: function () {\r\n        let d = document.createElement('div');\r\n        let svg = this._createSvgIn(d);\r\n        let ul = this._createUlIn(d);\r\n        this._appendColorBarTo(svg);\r\n\r\n        if (this.options.labels) {\r\n            this._appendLabelsTo(svg);\r\n            this._appendPhoneColorBarTo(ul);\r\n        }\r\n\r\n        return d.innerHTML;\r\n    },\r\n\r\n    _appendPhoneColorBarTo: function _appendPhoneColorBarTo(ul) {\r\n        var that = this;\r\n        var colorList = this.options.phoneColoe;\r\n        var labels = this.options.labels;\r\n        labels.forEach(function (value, key) {\r\n            var currentText = that.unit.value().conversion(value);\r\n            if (that.unit.value().precision || that.unit.value().precision === 0) {\r\n                currentText = currentText.toFixed(that.unit.value().precision);\r\n            }\r\n            ul.insert('li', '.phone-color-li:nth-child(1)').attr('class', 'phone-color-li text-center')\r\n                .text(currentText).style('color', 'white')\r\n                .style('background-color', 'rgb(' + colorList[key][0] + ',' + colorList[key][1] + ',' + colorList[key][2] + ')');\r\n        });\r\n        ul.style('display', 'none');\r\n    },\r\n    _createUlIn: function _createSvgIn(d) {\r\n        var ul = d3.select(d).append('ul').attr('id', 'phone_ul_color_bar').style('width', '50px').attr('class', 'leaflet-control-colorBar');\r\n        return ul;\r\n    },\r\n\r\n\r\n    _createSvgIn: function (d) {\r\n        let spaceForLabels = this.options.labels ? this.options.margin : 0;\r\n        let svg = d3\r\n            .select(d)\r\n            .append('svg').attr('id', 'pc_svg_color_bar')\r\n            .attr('width', this.options.width + this.options.margin * 2)\r\n            .attr('height', this.options.height + spaceForLabels);\r\n        return svg;\r\n    },\r\n\r\n    _appendColorBarTo: function (svg) {\r\n        const colorPerValue = this._getColorPerValue();\r\n        const w = this.options.width / colorPerValue.length;\r\n\r\n        let groupBars = svg.append('g').attr('id', 'colorBar-buckets');\r\n        let buckets = groupBars\r\n            .selectAll('rect')\r\n            .data(colorPerValue)\r\n            .enter()\r\n            .append('rect');\r\n        buckets\r\n            .attr('x', (d, i) => i * w + this.options.margin)\r\n            .attr('y', () => 0)\r\n            .attr('height', () => this.options.height /*w * 4*/)\r\n            .attr('width', () => w)\r\n            .attr('stroke-width', 2)\r\n            .attr('stroke-linecap', 'butt')\r\n            .attr('stroke', d => d.color.hex())\r\n            .attr('fill', d => d.color.hex());\r\n        buckets\r\n            .append('title')\r\n            .text(\r\n                d =>\r\n                    `${this.unit.value().conversion(d.value).toFixed(this.unit.value().precision)} ${this.unit.value().label\r\n                        }`\r\n            );\r\n    },\r\n\r\n    _appendLabelsTo: function (svg) {\r\n        const positionPerLabelValue = this._getPositionPerLabelValue();\r\n        //const w = this.options.width / colorPerValue.length;\r\n        let groupLabels = svg.append('g').attr('id', 'colorBar-labels');\r\n        let labels = groupLabels\r\n            .selectAll('text')\r\n            .data(positionPerLabelValue)\r\n            .enter()\r\n            .append('text');\r\n        labels\r\n            .attr('x', d => d.position + this.options.margin)\r\n            .attr('y', this.options.height + this.options.margin)\r\n            .attr('font-size', `${this.options.labelFontSize}px`)\r\n            .attr('text-anchor', this.options.labelTextPosition)\r\n            .attr('fill', this.options.textColor)\r\n            .attr('class', 'leaflet-control-colorBar-label')\r\n            .text(d => `${this.unit.value().conversion(d.value).toFixed(this.unit.value().precision)}`);\r\n    },\r\n\r\n    _getColorPerValue: function () {\r\n        const [min, max] = this.range;\r\n        let delta = (max - min) / this.options.steps;\r\n        let data = d3.range(min, max + delta, delta);\r\n        let colorPerValue = data.map(d => {\r\n            return {\r\n                value: d,\r\n                color: this.color(d)\r\n            };\r\n        });\r\n        return colorPerValue;\r\n    },\r\n\r\n    _getPositionPerLabelValue: function () {\r\n        var xPositionFor = d3\r\n            .scaleLinear()\r\n            .range([0, this.options.width])\r\n            .domain(this.range);\r\n        let data = this.options.labels;\r\n        let positionPerLabel = data.map(d => {\r\n            return {\r\n                value: d,\r\n                position: xPositionFor(d)\r\n            };\r\n        });\r\n        return positionPerLabel;\r\n    },\r\n\r\n    _createUnitToggle: function (id) {\r\n        var units = this.options.units, size = units.length;\r\n        var index = +(d3.select(id).attr('data-index') || 0) % size;\r\n        return {\r\n            value: function value() {\r\n                return units[index];\r\n            },\r\n            next: function next() {\r\n                d3.select(id).attr('data-index', index = (index + 1) % size);\r\n            }\r\n        };\r\n    },\r\n\r\n    _nextUnit: function () {\r\n        this.unit.next();\r\n        this.colorBar.innerHTML = this.title() + this.palette();\r\n        if (this.options.cb) this.options.cb();\r\n    },\r\n\r\n    show: function () {\r\n        this.colorBar.innerHTML = this.title() + this.palette();\r\n    }\r\n\r\n});\r\n\r\nL.control.colorBar = function (color, range, options) {\r\n    return new L.Control.ColorBar(color, range, options);\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./control/L.Control.ColorBar.js","/**\r\n * Abstract class for a Field layer on canvas, aka 'a Raster layer'\r\n * (ScalarField or a VectorField)\r\n */\r\nL.CanvasLayer.Field = L.CanvasLayer.extend({\r\n    options: {\r\n        mouseMoveCursor: {\r\n            value: 'pointer',\r\n            noValue: 'default'\r\n        },\r\n        opacity: 1,\r\n        onClick: null,\r\n        onMouseMove: null,\r\n        inFilter: null\r\n    },\r\n\r\n    initialize: function(field, options) {\r\n        L.Util.setOptions(this, options);\r\n        this._visible = true;\r\n        if (field) {\r\n            this.setData(field);\r\n        }\r\n    },\r\n\r\n    getEvents: function() {\r\n        var events = L.CanvasLayer.prototype.getEvents.call(this);\r\n        events.zoomstart = this._hideCanvas.bind(this);\r\n        events.zoomend = this._showCanvas.bind(this);\r\n        return events;\r\n    },\r\n\r\n    onLayerDidMount: function() {\r\n        this._enableIdentify();\r\n        this._ensureCanvasAlignment();\r\n    },\r\n\r\n    show() {\r\n        this._visible = true;\r\n        this._showCanvas();\r\n        this._enableIdentify();\r\n    },\r\n\r\n    hide() {\r\n        this._visible = false;\r\n        this._hideCanvas();\r\n        this._disableIdentify();\r\n    },\r\n\r\n    isVisible() {\r\n        return this._visible;\r\n    },\r\n\r\n    _showCanvas() {\r\n        if (this._canvas && this._visible) {\r\n            this._canvas.style.visibility = 'visible';\r\n        }\r\n    },\r\n\r\n    _hideCanvas() {\r\n        if (this._canvas) {\r\n            this._canvas.style.visibility = 'hidden';\r\n        }\r\n    },\r\n\r\n    _enableIdentify() {\r\n        this._map.on('click', this._onClick, this);\r\n        this._map.on('mousemove', this._onMouseMove, this);\r\n\r\n        this.options.onClick && this.on('click', this.options.onClick, this);\r\n        this.options.onMouseMove &&\r\n            this.on('mousemove', this.options.onMouseMove, this);\r\n    },\r\n\r\n    _disableIdentify() {\r\n        this._map.off('click', this._onClick, this);\r\n        this._map.off('mousemove', this._onMouseMove, this);\r\n\r\n        this.options.onClick && this.off('click', this.options.onClick, this);\r\n        this.options.onMouseMove &&\r\n            this.off('mousemove', this.options.onMouseMove, this);\r\n    },\r\n\r\n    _ensureCanvasAlignment() {\r\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\r\n        L.DomUtil.setPosition(this._canvas, topLeft);\r\n    },\r\n\r\n    onLayerWillUnmount: function() {\r\n        this._disableIdentify();\r\n    },\r\n\r\n    needRedraw() {\r\n        if (this._map && this._field) {\r\n            L.CanvasLayer.prototype.needRedraw.call(this);\r\n        }\r\n    },\r\n\r\n    /* eslint-disable no-unused-vars */\r\n    onDrawLayer: function(viewInfo) {\r\n        throw new TypeError('Must be overriden');\r\n    },\r\n    /* eslint-enable no-unused-vars */\r\n\r\n    setData: function(field) {\r\n        this.options.inFilter && field.setFilter(this.options.inFilter);\r\n        this._field = field;\r\n        this.needRedraw();\r\n        this.fire('load');\r\n    },\r\n\r\n    setFilter: function(f) {\r\n        this.options.inFilter = f;\r\n        this._field && this._field.setFilter(f);\r\n        this.needRedraw();\r\n    },\r\n\r\n    setOpacity: function(opacity) {\r\n        this.options.opacity = opacity;\r\n\r\n        if (this._canvas) {\r\n            this._updateOpacity();\r\n        }\r\n        return this;\r\n    },\r\n\r\n    getBounds: function() {\r\n        let bb = this._field.extent();\r\n\r\n        let southWest = L.latLng(bb[1], bb[0]),\r\n            northEast = L.latLng(bb[3], bb[2]);\r\n        let bounds = L.latLngBounds(southWest, northEast);\r\n        return bounds;\r\n    },\r\n\r\n    _onClick: function(e) {\r\n        let v = this._queryValue(e);\r\n        this.fire('click', v);\r\n    },\r\n\r\n    _onMouseMove: function(e) {\r\n        let v = this._queryValue(e);\r\n        this._changeCursorOn(v);\r\n        this.fire('mousemove', v);\r\n    },\r\n\r\n    _changeCursorOn: function(v) {\r\n        if (!this.options.mouseMoveCursor) return;\r\n\r\n        let { value, noValue } = this.options.mouseMoveCursor;\r\n        let style = this._map.getContainer().style;\r\n        style.cursor = v.value !== null ? value : noValue;\r\n    },\r\n\r\n    _updateOpacity: function() {\r\n        L.DomUtil.setOpacity(this._canvas, this.options.opacity);\r\n    },\r\n\r\n    _queryValue: function(e) {\r\n        let v = this._field\r\n            ? this._field.valueAt(e.latlng.lng, e.latlng.lat)\r\n            : null;\r\n        let result = {\r\n            latlng: e.latlng,\r\n            value: v\r\n        };\r\n        return result;\r\n    },\r\n\r\n    _getDrawingContext: function() {\r\n        let g = this._canvas.getContext('2d');\r\n        g.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n        return g;\r\n    }\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.Field.js","import Cell from '../Cell';\r\n\r\n/**\r\n * ScalarField on canvas (a 'Raster')\r\n */\r\nL.CanvasLayer.ScalarField = L.CanvasLayer.Field.extend({\r\n    options: {\r\n        type: 'colormap', // [colormap|vector]\r\n        color: null, // function colorFor(value) [e.g. chromajs.scale],\r\n        interpolate: false, // Change to use interpolation\r\n        vectorSize: 20, // only used if 'vector'\r\n        arrowDirection: 'from' // [from|towards]\r\n    },\r\n\r\n    initialize: function(scalarField, options) {\r\n        L.CanvasLayer.Field.prototype.initialize.call(\r\n            this,\r\n            scalarField,\r\n            options\r\n        );\r\n        L.Util.setOptions(this, options);\r\n    },\r\n\r\n    _defaultColorScale: function() {\r\n        return chroma.scale(['white', 'black']).domain(this._field.range);\r\n    },\r\n\r\n    setColor(f) {\r\n        this.options.color = f;\r\n        this.needRedraw();\r\n    },\r\n\r\n    /* eslint-disable no-unused-vars */\r\n    onDrawLayer: function(viewInfo) {\r\n        if (!this.isVisible()) return;\r\n        this._updateOpacity();\r\n\r\n        let r = this._getRendererMethod();\r\n        //console.time('onDrawLayer');\r\n        r();\r\n        //console.timeEnd('onDrawLayer');\r\n    },\r\n    /* eslint-enable no-unused-vars */\r\n\r\n    _getRendererMethod: function() {\r\n        switch (this.options.type) {\r\n            case 'colormap':\r\n                return this._drawImage.bind(this);\r\n            case 'vector':\r\n                return this._drawArrows.bind(this);\r\n            default:\r\n                throw Error(`Unkwown renderer type: ${this.options.type}`);\r\n        }\r\n    },\r\n\r\n    _ensureColor: function() {\r\n        if (this.options.color === null) {\r\n            this.setColor(this._defaultColorScale());\r\n        }\r\n    },\r\n\r\n    _showCanvas() {\r\n        L.CanvasLayer.Field.prototype._showCanvas.call(this);\r\n        this.needRedraw(); // TODO check spurious redraw (e.g. hide/show without moving map)\r\n    },\r\n\r\n    /**\r\n     * Draws the field in an ImageData and applying it with putImageData.\r\n     * Used as a reference: http://geoexamples.com/d3-raster-tools-docs/code_samples/raster-pixels-page.html\r\n     */\r\n    _drawImage: function() {\r\n        this._ensureColor();\r\n\r\n        let ctx = this._getDrawingContext();\r\n        let width = this._canvas.width;\r\n        let height = this._canvas.height;\r\n\r\n        let img = ctx.createImageData(width, height);\r\n        let data = img.data;\r\n\r\n        this._prepareImageIn(data, width, height);\r\n        ctx.putImageData(img, 0, 0);\r\n    },\r\n\r\n    deg2rad(deg) {\r\n        return deg / 180 * Math.PI;\r\n    },\r\n\r\n    rad2deg(ang) {\r\n        return ang / (Math.PI / 180.0);\r\n    },\r\n\r\n    _invert(x, y, windy) {\r\n        var mapLonDelta = windy.east - windy.west;\r\n        var worldMapRadius = windy.width / this.rad2deg(mapLonDelta) * 360 / (2 * Math.PI);\r\n        var mapOffsetY = worldMapRadius / 2 * Math.log((1 + Math.sin(windy.south)) / (1 - Math.sin(windy.south)));\r\n        var equatorY = windy.height + mapOffsetY;\r\n        var a = (equatorY - y) / worldMapRadius;\r\n\r\n        var lat = 180 / Math.PI * (2 * Math.atan(Math.exp(a)) - Math.PI / 2);\r\n        var lon = this.rad2deg(windy.west) + x / windy.width * this.rad2deg(mapLonDelta);\r\n        return {lng: lon, lat: lat};\r\n    },\r\n\r\n    /**\r\n     * Prepares the image in data, as array with RGBAs\r\n     * [R1, G1, B1, A1, R2, G2, B2, A2...]\r\n     * @private\r\n     * @param {[[Type]]} data   [[Description]]\r\n     * @param {Numver} width\r\n     * @param {Number} height\r\n     */\r\n    _prepareImageIn(data, width, height) {\r\n        let f = this.options.interpolate ? 'interpolatedValueAt' : 'valueAt';\r\n        // var bounds = this._map.getBounds();\r\n        // var extent = [[bounds._southWest.lng, bounds._southWest.lat], [bounds._northEast.lng, bounds._northEast.lat]];\r\n        // var windy = {\r\n        //     south: this.deg2rad(extent[0][1]),\r\n        //     north: this.deg2rad(extent[1][1]),\r\n        //     east:  this.deg2rad(extent[1][0]),\r\n        //     west:  this.deg2rad(extent[0][0]),\r\n        //     width: width,\r\n        //     height: height\r\n        // };\r\n        let pos = 0;\r\n        let step = 2;     //  1 or 2\r\n        for (let j = 0; j < height; j+=step) {\r\n            for (let i = 0; i < width; i+=step) {\r\n                let pointCoords = this._map.containerPointToLatLng([i, j]);\r\n                let lon = pointCoords.lng;\r\n                let lat = pointCoords.lat;\r\n\r\n                let v = this._field[f](lon, lat); // 'valueAt' | 'interpolatedValueAt' || TODO check some 'artifacts'\r\n                if (v !== null) {\r\n                    let color = this._getColorFor(v);\r\n                    let [R, G, B, A] = color.rgba();\r\n                    data[pos] = R;\r\n                    data[pos + 1] = G;\r\n                    data[pos + 2] = B;\r\n                    data[pos + 3] = parseInt(A * 255); // not percent in alpha but hex 0-255\r\n                    if(step>1){\r\n                        data[pos+4] = R;\r\n                        data[pos+4 + 1] = G;\r\n                        data[pos+4 + 2] = B;\r\n                        data[pos+4 + 3] = parseInt(A * 255); // not percent in alpha but hex 0-255\r\n                        data[pos+width*4] = R;\r\n                        data[pos+width*4 + 1] = G;\r\n                        data[pos+width*4 + 2] = B;\r\n                        data[pos+width*4 + 3] = parseInt(A * 255); // not percent in alpha but hex 0-255\r\n                        data[pos+width*4+4] = R;\r\n                        data[pos+width*4+4 + 1] = G;\r\n                        data[pos+width*4+4 + 2] = B;\r\n                        data[pos+width*4+4 + 3] = parseInt(A * 255); // not percent in alpha but hex 0-255\r\n                    }\r\n                }\r\n                pos = pos + 4*step;\r\n            }\r\n            let w = 0;\r\n            if(width%2 !== 0) w = 1;\r\n            pos = pos + (width-w)*(step-1)*4;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Draws the field as a set of arrows. Direction from 0 to 360 is assumed.\r\n     */\r\n    _drawArrows: function() {\r\n        const bounds = this._pixelBounds();\r\n        const pixelSize = (bounds.max.x - bounds.min.x) / this._field.nCols;\r\n\r\n        var stride = Math.max(\r\n            1,\r\n            Math.floor(1.2 * this.options.vectorSize / pixelSize)\r\n        );\r\n\r\n        const ctx = this._getDrawingContext();\r\n        ctx.strokeStyle = this.options.color;\r\n\r\n        var currentBounds = this._map.getBounds();\r\n\r\n        for (var y = 0; y < this._field.height; y = y + stride) {\r\n            for (var x = 0; x < this._field.width; x = x + stride) {\r\n                let [lon, lat] = this._field._lonLatAtIndexes(x, y);\r\n                let v = this._field.valueAt(lon, lat);\r\n                let center = L.latLng(lat, lon);\r\n                if (v !== null && currentBounds.contains(center)) {\r\n                    let cell = new Cell(\r\n                        center,\r\n                        v,\r\n                        this.cellXSize,\r\n                        this.cellYSize\r\n                    );\r\n                    this._drawArrow(cell, ctx);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    _pixelBounds: function() {\r\n        const bounds = this.getBounds();\r\n        const northWest = this._map.latLngToContainerPoint(\r\n            bounds.getNorthWest()\r\n        );\r\n        const southEast = this._map.latLngToContainerPoint(\r\n            bounds.getSouthEast()\r\n        );\r\n        var pixelBounds = L.bounds(northWest, southEast);\r\n        return pixelBounds;\r\n    },\r\n\r\n    _drawArrow: function(cell, ctx) {\r\n        var projected = this._map.latLngToContainerPoint(cell.center);\r\n\r\n        // colormap vs. simple color\r\n        let color = this.options.color;\r\n        if (typeof color === 'function') {\r\n            ctx.strokeStyle = color(cell.value);\r\n        }\r\n\r\n        const size = this.options.vectorSize;\r\n        ctx.save();\r\n\r\n        ctx.translate(projected.x, projected.y);\r\n\r\n        let rotationRads = (90 + cell.value) * Math.PI / 180; // from, by default\r\n        if (this.options.arrowDirection === 'towards') {\r\n            rotationRads = rotationRads + Math.PI;\r\n        }\r\n        ctx.rotate(rotationRads);\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(-size / 2, 0);\r\n        ctx.lineTo(+size / 2, 0);\r\n        ctx.moveTo(size * 0.25, -size * 0.25);\r\n        ctx.lineTo(+size / 2, 0);\r\n        ctx.lineTo(size * 0.25, size * 0.25);\r\n        ctx.stroke();\r\n        ctx.restore();\r\n    },\r\n\r\n    /**\r\n     * Gets a chroma color for a pixel value, according to 'options.color'\r\n     */\r\n    _getColorFor(v) {\r\n        // let c = this.options.color; // e.g. for a constant 'red'\r\n        // if (typeof c === 'function') {\r\n            // c = this.options.color(v);\r\n        // }\r\n        // let color = chroma(c); // to be more flexible, a chroma color object is always created || TODO improve efficiency\r\n        return this.options.color(v);\r\n    }\r\n});\r\n\r\nL.canvasLayer.scalarField = function(scalarField, options) {\r\n    return new L.CanvasLayer.ScalarField(scalarField, options);\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.ScalarField.js","/**\r\n *  Simple layer with lon-lat points\r\n *\r\n *  TODO rename to SimplePoint?\r\n */\r\nL.CanvasLayer.SimpleLonLat = L.CanvasLayer.extend({\r\n    options: {\r\n        color: 'gray'\r\n    },\r\n\r\n    initialize: function(points, options) {\r\n        this.points = points;\r\n        L.Util.setOptions(this, options);\r\n    },\r\n\r\n    onLayerDidMount: function() {\r\n        // -- prepare custom drawing\r\n    },\r\n\r\n    onLayerWillUnmount: function() {\r\n        // -- custom cleanup\r\n    },\r\n\r\n    /* eslint-disable no-unused-vars */\r\n    setData: function(data) {\r\n        // -- custom data set\r\n        this.needRedraw(); // -- call to drawLayer\r\n    },\r\n    /* eslint-enable no-unused-vars */\r\n\r\n    onDrawLayer: function(viewInfo) {\r\n        // canvas preparation\r\n        let g = viewInfo.canvas.getContext('2d');\r\n        g.clearRect(0, 0, viewInfo.canvas.width, viewInfo.canvas.height);\r\n        g.fillStyle = this.options.color;\r\n\r\n        for (let point of this.points) {\r\n            let p = viewInfo.layer._map.latLngToContainerPoint(point);\r\n            g.beginPath();\r\n            //g.arc(p.x, p.y, 1, 0, Math.PI * 2); // circle | TODO style 'function' as parameter?\r\n            g.fillRect(p.x, p.y, 2, 2); //simple point\r\n            g.fill();\r\n            g.closePath();\r\n            g.stroke();\r\n        }\r\n    },\r\n\r\n    getBounds: function() {\r\n        // TODO: bounding with points...\r\n        let xs = this.points.map(pt => pt.lng);\r\n        let ys = this.points.map(pt => pt.lat);\r\n\r\n        let xmin = Math.min(...xs);\r\n        let ymin = Math.min(...ys);\r\n        let xmax = Math.max(...xs);\r\n        let ymax = Math.max(...ys);\r\n\r\n        let southWest = L.latLng(ymin, xmin),\r\n            northEast = L.latLng(ymax, xmax);\r\n        let bounds = L.latLngBounds(southWest, northEast); // TODO FIX ERROR ? half-pixel?\r\n        return bounds;\r\n    }\r\n});\r\n\r\nL.canvasLayer.simpleLonLat = function(lonslats, options) {\r\n    return new L.CanvasLayer.SimpleLonLat(lonslats, options);\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.SimpleLonLat.js","/**\r\n * Animated VectorField on canvas\r\n */\r\nL.CanvasLayer.VectorFieldAnim = L.CanvasLayer.Field.extend({\r\n    options: {\r\n        paths: 800,\r\n        color: 'white', // html-color | function colorFor(value) [e.g. chromajs.scale]\r\n        width: 1.0, // number | function widthFor(value)\r\n        fade: 0.96, // 0 to 1\r\n        duration: 20, // milliseconds per 'frame'\r\n        maxAge: 200, // number of maximum frames per path\r\n        velocityScale: 1 / 5000\r\n    },\r\n\r\n    initialize: function(vectorField, options) {\r\n        L.CanvasLayer.Field.prototype.initialize.call(\r\n            this,\r\n            vectorField,\r\n            options\r\n        );\r\n        L.Util.setOptions(this, options);\r\n\r\n        this.timer = null;\r\n    },\r\n\r\n    onLayerDidMount: function() {\r\n        L.CanvasLayer.Field.prototype.onLayerDidMount.call(this);\r\n        this._map.on('move resize', this._stopAnimation, this);\r\n    },\r\n\r\n    onLayerWillUnmount: function() {\r\n        L.CanvasLayer.Field.prototype.onLayerWillUnmount.call(this);\r\n        this._map.off('move resize', this._stopAnimation, this);\r\n        this._stopAnimation();\r\n    },\r\n\r\n    _hideCanvas: function _showCanvas() {\r\n        L.CanvasLayer.Field.prototype._hideCanvas.call(this);\r\n        this._stopAnimation();\r\n    },\r\n\r\n    onDrawLayer: function(viewInfo) {\r\n        if (!this._field || !this.isVisible()) return;\r\n\r\n        this._updateOpacity();\r\n\r\n        let ctx = this._getDrawingContext();\r\n        let paths = this._prepareParticlePaths();\r\n\r\n        this.timer = d3.timer(function() {\r\n            _moveParticles();\r\n            _drawParticles();\r\n        }, this.options.duration);\r\n\r\n        let self = this;\r\n\r\n        /**\r\n         * Builds the paths, adding 'particles' on each animation step, considering\r\n         * their properties (age / position source > target)\r\n         */\r\n        function _moveParticles() {\r\n            // let screenFactor = 1 / self._map.getZoom(); // consider using a 'screenFactor' to ponderate velocityScale\r\n            paths.forEach(function(par) {\r\n                if (par.age > self.options.maxAge) {\r\n                    // restart, on a random x,y\r\n                    par.age = 0;\r\n                    self._field.randomPosition(par);\r\n                }\r\n\r\n                let vector = self._field.valueAt(par.x, par.y);\r\n                if (vector === null) {\r\n                    par.age = self.options.maxAge;\r\n                } else {\r\n                    // the next point will be...\r\n                    let xt = par.x + vector.u * self.options.velocityScale; //* screenFactor;\r\n                    let yt = par.y + vector.v * self.options.velocityScale; //* screenFactor;\r\n\r\n                    if (self._field.hasValueAt(xt, yt)) {\r\n                        par.xt = xt;\r\n                        par.yt = yt;\r\n                        par.m = vector.magnitude();\r\n                    } else {\r\n                        // not visible anymore...\r\n                        par.age = self.options.maxAge;\r\n                    }\r\n                }\r\n                par.age += 1;\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Draws the paths on each step\r\n         */\r\n        function _drawParticles() {\r\n            // Previous paths...\r\n            let prev = ctx.globalCompositeOperation;\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            //ctx.globalCompositeOperation = 'source-over';\r\n            ctx.globalCompositeOperation = prev;\r\n\r\n            // fading paths...\r\n            ctx.fillStyle = `rgba(0, 0, 0, ${self.options.fade})`;\r\n            ctx.lineWidth = self.options.width;\r\n            ctx.strokeStyle = self.options.color;\r\n\r\n            // New paths\r\n            paths.forEach(function(par) {\r\n                self._drawParticle(viewInfo, ctx, par);\r\n            });\r\n        }\r\n    },\r\n\r\n    _drawParticle(viewInfo, ctx, par) {\r\n        let source = new L.latLng(par.y, par.x);\r\n        let target = new L.latLng(par.yt, par.xt);\r\n\r\n        if (\r\n            viewInfo.bounds.contains(source) &&\r\n            par.age <= this.options.maxAge\r\n        ) {\r\n            let pA = viewInfo.layer._map.latLngToContainerPoint(source);\r\n            let pB = viewInfo.layer._map.latLngToContainerPoint(target);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(pA.x, pA.y);\r\n            ctx.lineTo(pB.x, pB.y);\r\n\r\n            // next-step movement\r\n            par.x = par.xt;\r\n            par.y = par.yt;\r\n\r\n            // colormap vs. simple color\r\n            let color = this.options.color;\r\n            if (typeof color === 'function') {\r\n                ctx.strokeStyle = color(par.m);\r\n            }\r\n\r\n            let width = this.options.width;\r\n            if (typeof width === 'function') {\r\n                ctx.lineWidth = width(par.m);\r\n            }\r\n\r\n            ctx.stroke();\r\n        }\r\n    },\r\n\r\n    _prepareParticlePaths: function() {\r\n        let paths = [];\r\n\r\n        for (var i = 0; i < this.options.paths; i++) {\r\n            let p = this._field.randomPosition();\r\n            p.age = this._randomAge();\r\n            paths.push(p);\r\n        }\r\n        return paths;\r\n    },\r\n\r\n    _randomAge: function() {\r\n        return Math.floor(Math.random() * this.options.maxAge);\r\n    },\r\n\r\n    _stopAnimation: function() {\r\n        if (this.timer) {\r\n            this.timer.stop();\r\n        }\r\n    }\r\n});\r\n\r\nL.canvasLayer.vectorFieldAnim = function(vectorField, options) {\r\n    return new L.CanvasLayer.VectorFieldAnim(vectorField, options);\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.VectorFieldAnim.js","/*\r\n  1.0.1 (downloaded from https://github.com/Sumbera/gLayers.Leaflet/releases/tag/v1.0.1)\r\n\r\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc,\r\n  copyright Stanislav Sumbera,  2016 , sumbera.com , license MIT\r\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\r\n*/\r\n\r\nL.CanvasLayer = L.Layer.extend({\r\n    // -- initialized is called on prototype\r\n    initialize: function (options) {\r\n        this._map = null;\r\n        this._canvas = null;\r\n        this._frame = null;\r\n        this._delegate = null;\r\n        L.setOptions(this, options);\r\n    },\r\n\r\n    delegate: function (del) {\r\n        this._delegate = del;\r\n        return this;\r\n    },\r\n\r\n    needRedraw: function () {\r\n        if (!this._frame) {\r\n            this._frame = L.Util.requestAnimFrame(this.drawLayer, this);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    //-------------------------------------------------------------\r\n    _onLayerDidResize: function (resizeEvent) {\r\n        this._canvas.width = resizeEvent.newSize.x;\r\n        this._canvas.height = resizeEvent.newSize.y;\r\n    },\r\n    //-------------------------------------------------------------\r\n    _onLayerDidMove: function () {\r\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\r\n        L.DomUtil.setPosition(this._canvas, topLeft);\r\n        this.drawLayer();\r\n    },\r\n    //-------------------------------------------------------------\r\n    getEvents: function () {\r\n        var events = {\r\n            resize: this._onLayerDidResize,\r\n            moveend: this._onLayerDidMove\r\n        };\r\n        if (this._map.options.zoomAnimation && L.Browser.any3d) {\r\n            events.zoomanim = this._animateZoom;\r\n        }\r\n\r\n        return events;\r\n    },\r\n    //-------------------------------------------------------------\r\n    onAdd: function (map) {\r\n        this._map = map;\r\n        this._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\r\n        this.tiles = {};\r\n\r\n        var size = this._map.getSize();\r\n        this._canvas.width = size.x;\r\n        this._canvas.height = size.y;\r\n\r\n        var animated = this._map.options.zoomAnimation && L.Browser.any3d;\r\n        L.DomUtil.addClass(this._canvas, 'leaflet-zoom-' + (animated ? 'animated' : 'hide'));\r\n\r\n\r\n        map._panes.overlayPane.appendChild(this._canvas);\r\n\r\n        map.on(this.getEvents(), this);\r\n\r\n        var del = this._delegate || this;\r\n        del.onLayerDidMount && del.onLayerDidMount(); // -- callback\r\n\r\n        this.needRedraw();\r\n\r\n        var self = this;\r\n        setTimeout(function () {\r\n            self._onLayerDidMove();\r\n        }, 0);\r\n    },\r\n\r\n    //-------------------------------------------------------------\r\n    onRemove: function (map) {\r\n        var del = this._delegate || this;\r\n        del.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\r\n\r\n\r\n        map.getPanes().overlayPane.removeChild(this._canvas);\r\n\r\n        map.off(this.getEvents(), this);\r\n\r\n        this._canvas = null;\r\n\r\n    },\r\n\r\n    //------------------------------------------------------------\r\n    addTo: function (map) {\r\n        map.addLayer(this);\r\n        return this;\r\n    },\r\n    // --------------------------------------------------------------------------------\r\n    LatLonToMercator: function (latlon) {\r\n        return {\r\n            x: latlon.lng * 6378137 * Math.PI / 180,\r\n            y: Math.log(Math.tan((90 + latlon.lat) * Math.PI / 360)) * 6378137\r\n        };\r\n    },\r\n\r\n    //------------------------------------------------------------------------------\r\n    drawLayer: function () {\r\n        // -- todo make the viewInfo properties  flat objects.\r\n        var size = this._map.getSize();\r\n        var bounds = this._map.getBounds();\r\n        var zoom = this._map.getZoom();\r\n\r\n        var center = this.LatLonToMercator(this._map.getCenter());\r\n        var corner = this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize()));\r\n\r\n        var del = this._delegate || this;\r\n        del.onDrawLayer && del.onDrawLayer({\r\n            layer: this,\r\n            canvas: this._canvas,\r\n            bounds: bounds,\r\n            size: size,\r\n            zoom: zoom,\r\n            center: center,\r\n            corner: corner\r\n        });\r\n        this._frame = null;\r\n    },\r\n    // -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\r\n    //------------------------------------------------------------------------------\r\n    _setTransform: function _setTransform(el, offset, scale) {\r\n        var pos = offset || new L.Point(0, 0);\r\n\r\n        el.style[L.DomUtil.TRANSFORM] = (L.Browser.ie3d ? 'translate(' + pos.x + 'px,' + pos.y + 'px)' : 'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') + (scale ? ' scale(' + scale + ')' : '');\r\n    },\r\n\r\n    //------------------------------------------------------------------------------\r\n    _animateZoom: function (e) {\r\n        var scale = this._map.getZoomScale(e.zoom);\r\n        var offset = this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(), e.zoom, e.center);\r\n\r\n        L.DomUtil.setTransform(this._canvas, offset, scale);\r\n    }\r\n});\r\n\r\nL.canvasLayer = function () {\r\n    return new L.CanvasLayer();\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./layer/L.CanvasLayer.js","var invariant = require('@turf/invariant');\nvar getCoord = invariant.getCoord;\nvar getCoords = invariant.getCoords;\n\n// http://en.wikipedia.org/wiki/Even%E2%80%93odd_rule\n// modified from: https://github.com/substack/point-in-polygon/blob/master/index.js\n// which was modified from http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n\n/**\n * Takes a {@link Point} and a {@link Polygon} or {@link MultiPolygon} and determines if the point resides inside the polygon. The polygon can\n * be convex or concave. The function accounts for holes.\n *\n * @name inside\n * @param {Feature<Point>} point input point\n * @param {Feature<Polygon|MultiPolygon>} polygon input polygon or multipolygon\n * @param {boolean} [ignoreBoundary=false] True if polygon boundary should be ignored when determining if the point is inside the polygon otherwise false.\n * @returns {boolean} `true` if the Point is inside the Polygon; `false` if the Point is not inside the Polygon\n * @example\n * var pt = turf.point([-77, 44]);\n * var poly = turf.polygon([[\n *   [-81, 41],\n *   [-81, 47],\n *   [-72, 47],\n *   [-72, 41],\n *   [-81, 41]\n * ]]);\n *\n * turf.inside(pt, poly);\n * //= true\n */\nmodule.exports = function (point, polygon, ignoreBoundary) {\n    // validation\n    if (!point) throw new Error('point is required');\n    if (!polygon) throw new Error('polygon is required');\n\n    var pt = getCoord(point);\n    var polys = getCoords(polygon);\n    var type = (polygon.geometry) ? polygon.geometry.type : polygon.type;\n    var bbox = polygon.bbox;\n\n    // Quick elimination if point is not inside bbox\n    if (bbox && inBBox(pt, bbox) === false) return false;\n\n    // normalize to multipolygon\n    if (type === 'Polygon') polys = [polys];\n\n    for (var i = 0, insidePoly = false; i < polys.length && !insidePoly; i++) {\n        // check if it is in the outer ring first\n        if (inRing(pt, polys[i][0], ignoreBoundary)) {\n            var inHole = false;\n            var k = 1;\n            // check for the point in any of the holes\n            while (k < polys[i].length && !inHole) {\n                if (inRing(pt, polys[i][k], !ignoreBoundary)) {\n                    inHole = true;\n                }\n                k++;\n            }\n            if (!inHole) insidePoly = true;\n        }\n    }\n    return insidePoly;\n};\n\n/**\n * inRing\n *\n * @private\n * @param {[number, number]} pt [x,y]\n * @param {Array<[number, number]>} ring [[x,y], [x,y],..]\n * @param {boolean} ignoreBoundary ignoreBoundary\n * @returns {boolean} inRing\n */\nfunction inRing(pt, ring, ignoreBoundary) {\n    var isInside = false;\n    if (ring[0][0] === ring[ring.length - 1][0] && ring[0][1] === ring[ring.length - 1][1]) ring = ring.slice(0, ring.length - 1);\n\n    for (var i = 0, j = ring.length - 1; i < ring.length; j = i++) {\n        var xi = ring[i][0], yi = ring[i][1];\n        var xj = ring[j][0], yj = ring[j][1];\n        var onBoundary = (pt[1] * (xi - xj) + yi * (xj - pt[0]) + yj * (pt[0] - xi) === 0) &&\n            ((xi - pt[0]) * (xj - pt[0]) <= 0) && ((yi - pt[1]) * (yj - pt[1]) <= 0);\n        if (onBoundary) return !ignoreBoundary;\n        var intersect = ((yi > pt[1]) !== (yj > pt[1])) &&\n        (pt[0] < (xj - xi) * (pt[1] - yi) / (yj - yi) + xi);\n        if (intersect) isInside = !isInside;\n    }\n    return isInside;\n}\n\n/**\n * inBBox\n *\n * @private\n * @param {[number, number]} pt point [x,y]\n * @param {[number, number, number, number]} bbox BBox [west, south, east, north]\n * @returns {boolean} true/false if point is inside BBox\n */\nfunction inBBox(pt, bbox) {\n    return bbox[0] <= pt[0] &&\n           bbox[1] <= pt[1] &&\n           bbox[2] >= pt[0] &&\n           bbox[3] >= pt[1];\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/@turf/inside/index.js\n// module id = 11\n// module chunks = 0","/**\n * Unwrap a coordinate from a Point Feature, Geometry or a single coordinate.\n *\n * @name getCoord\n * @param {Array<number>|Geometry<Point>|Feature<Point>} obj Object\n * @returns {Array<number>} coordinates\n * @example\n * var pt = turf.point([10, 10]);\n *\n * var coord = turf.getCoord(pt);\n * //= [10, 10]\n */\nfunction getCoord(obj) {\n    if (!obj) throw new Error('obj is required');\n\n    var coordinates = getCoords(obj);\n\n    // getCoord() must contain at least two numbers (Point)\n    if (coordinates.length > 1 &&\n        typeof coordinates[0] === 'number' &&\n        typeof coordinates[1] === 'number') {\n        return coordinates;\n    } else {\n        throw new Error('Coordinate is not a valid Point');\n    }\n}\n\n/**\n * Unwrap coordinates from a Feature, Geometry Object or an Array of numbers\n *\n * @name getCoords\n * @param {Array<number>|Geometry|Feature} obj Object\n * @returns {Array<number>} coordinates\n * @example\n * var poly = turf.polygon([[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]);\n *\n * var coord = turf.getCoords(poly);\n * //= [[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]\n */\nfunction getCoords(obj) {\n    if (!obj) throw new Error('obj is required');\n    var coordinates;\n\n    // Array of numbers\n    if (obj.length) {\n        coordinates = obj;\n\n    // Geometry Object\n    } else if (obj.coordinates) {\n        coordinates = obj.coordinates;\n\n    // Feature\n    } else if (obj.geometry && obj.geometry.coordinates) {\n        coordinates = obj.geometry.coordinates;\n    }\n    // Checks if coordinates contains a number\n    if (coordinates) {\n        containsNumber(coordinates);\n        return coordinates;\n    }\n    throw new Error('No valid coordinates');\n}\n\n/**\n * Checks if coordinates contains a number\n *\n * @name containsNumber\n * @param {Array<any>} coordinates GeoJSON Coordinates\n * @returns {boolean} true if Array contains a number\n */\nfunction containsNumber(coordinates) {\n    if (coordinates.length > 1 &&\n        typeof coordinates[0] === 'number' &&\n        typeof coordinates[1] === 'number') {\n        return true;\n    }\n\n    if (Array.isArray(coordinates[0]) && coordinates[0].length) {\n        return containsNumber(coordinates[0]);\n    }\n    throw new Error('coordinates must only contain numbers');\n}\n\n/**\n * Enforce expectations about types of GeoJSON objects for Turf.\n *\n * @name geojsonType\n * @param {GeoJSON} value any GeoJSON object\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} if value is not the expected type.\n */\nfunction geojsonType(value, type, name) {\n    if (!type || !name) throw new Error('type and name required');\n\n    if (!value || value.type !== type) {\n        throw new Error('Invalid input to ' + name + ': must be a ' + type + ', given ' + value.type);\n    }\n}\n\n/**\n * Enforce expectations about types of {@link Feature} inputs for Turf.\n * Internally this uses {@link geojsonType} to judge geometry types.\n *\n * @name featureOf\n * @param {Feature} feature a feature with an expected geometry type\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} error if value is not the expected type.\n */\nfunction featureOf(feature, type, name) {\n    if (!feature) throw new Error('No feature passed');\n    if (!name) throw new Error('.featureOf() requires a name');\n    if (!feature || feature.type !== 'Feature' || !feature.geometry) {\n        throw new Error('Invalid input to ' + name + ', Feature with geometry required');\n    }\n    if (!feature.geometry || feature.geometry.type !== type) {\n        throw new Error('Invalid input to ' + name + ': must be a ' + type + ', given ' + feature.geometry.type);\n    }\n}\n\n/**\n * Enforce expectations about types of {@link FeatureCollection} inputs for Turf.\n * Internally this uses {@link geojsonType} to judge geometry types.\n *\n * @name collectionOf\n * @param {FeatureCollection} featureCollection a FeatureCollection for which features will be judged\n * @param {string} type expected GeoJSON type\n * @param {string} name name of calling function\n * @throws {Error} if value is not the expected type.\n */\nfunction collectionOf(featureCollection, type, name) {\n    if (!featureCollection) throw new Error('No featureCollection passed');\n    if (!name) throw new Error('.collectionOf() requires a name');\n    if (!featureCollection || featureCollection.type !== 'FeatureCollection') {\n        throw new Error('Invalid input to ' + name + ', FeatureCollection required');\n    }\n    for (var i = 0; i < featureCollection.features.length; i++) {\n        var feature = featureCollection.features[i];\n        if (!feature || feature.type !== 'Feature' || !feature.geometry) {\n            throw new Error('Invalid input to ' + name + ', Feature with geometry required');\n        }\n        if (!feature.geometry || feature.geometry.type !== type) {\n            throw new Error('Invalid input to ' + name + ': must be a ' + type + ', given ' + feature.geometry.type);\n        }\n    }\n}\n\n/**\n * Get Geometry from Feature or Geometry Object\n *\n * @param {Feature|Geometry} geojson GeoJSON Feature or Geometry Object\n * @returns {Geometry|null} GeoJSON Geometry Object\n * @throws {Error} if geojson is not a Feature or Geometry Object\n * @example\n * var point = {\n *   \"type\": \"Feature\",\n *   \"properties\": {},\n *   \"geometry\": {\n *     \"type\": \"Point\",\n *     \"coordinates\": [110, 40]\n *   }\n * }\n * var geom = turf.getGeom(point)\n * //={\"type\": \"Point\", \"coordinates\": [110, 40]}\n */\nfunction getGeom(geojson) {\n    if (!geojson) throw new Error('geojson is required');\n    if (geojson.geometry !== undefined) return geojson.geometry;\n    if (geojson.coordinates || geojson.geometries) return geojson;\n    throw new Error('geojson must be a valid Feature or Geometry Object');\n}\n\n/**\n * Get Geometry Type from Feature or Geometry Object\n *\n * @param {Feature|Geometry} geojson GeoJSON Feature or Geometry Object\n * @returns {string} GeoJSON Geometry Type\n * @throws {Error} if geojson is not a Feature or Geometry Object\n * @example\n * var point = {\n *   \"type\": \"Feature\",\n *   \"properties\": {},\n *   \"geometry\": {\n *     \"type\": \"Point\",\n *     \"coordinates\": [110, 40]\n *   }\n * }\n * var geom = turf.getGeomType(point)\n * //=\"Point\"\n */\nfunction getGeomType(geojson) {\n    if (!geojson) throw new Error('geojson is required');\n    var geom = getGeom(geojson);\n    if (geom) return geom.type;\n}\n\nmodule.exports = {\n    geojsonType: geojsonType,\n    collectionOf: collectionOf,\n    featureOf: featureOf,\n    getCoord: getCoord,\n    getCoords: getCoords,\n    containsNumber: containsNumber,\n    getGeom: getGeom,\n    getGeomType: getGeomType\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/@turf/invariant/index.js\n// module id = 12\n// module chunks = 0","// base\r\nimport Vector from './Vector.js';\r\nwindow.L.Vector = Vector;\r\n\r\nimport Cell from './Cell.js';\r\nwindow.L.Cell = Cell;\r\n\r\nimport Field from './Field.js';\r\nwindow.L.Field = Field;\r\n\r\nimport ScalarField from './ScalarField.js';\r\nwindow.L.ScalarField = ScalarField;\r\n\r\nimport VectorField from './VectorField.js';\r\nwindow.L.VectorField = VectorField;\r\n\r\n// layer\r\nrequire('./layer/L.CanvasLayer.js');\r\nrequire('./layer/L.CanvasLayer.SimpleLonLat.js');\r\nrequire('./layer/L.CanvasLayer.Field.js');\r\nrequire('./layer/L.CanvasLayer.ScalarField.js');\r\nrequire('./layer/L.CanvasLayer.VectorFieldAnim.js');\r\n\r\n// control\r\nrequire('./control/L.Control.ColorBar.js');\r\n\r\n/* eslint-disable no-console */\r\nconsole.log('leaflet.canvaslayer.field v1.4.1');\r\n/* eslint-enable no-console */\r\n\n\n\n// WEBPACK FOOTER //\n// ./_main.js"],"sourceRoot":""}